<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.6 at 2016-09-17 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160917" />
    <meta http-equiv="Content-Language" content="en" />
    <title>confd Maven Plugin &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>confd Maven Plugin</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2016-09-17
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.1.0-SNAPSHOT
                      </li>
                      
              
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="plugin-info.html" title="Goals">
          <span class="none"></span>
        Goals</a>
            </li>
                
      <li>
  
                          <a href="usage.html" title="Usage">
          <span class="none"></span>
        Usage</a>
            </li>
                              <li class="nav-header">Examples</li>
                              
      <li class="active">
  
            <a href="#"><span class="none"></span>Simple Usage</a>
          </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="sect1">
<h2 id="examples">Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="basic_usage_prepare_generate_in_a_single_step">Basic usage: prepare + generate in a single step</h3>
<div class="paragraph">
<p>Let&#8217;s say that you have 2 files to generate, <code>file01.properties</code> and <code>datasource.xml</code>, in the <code>target/generated-configuration</code> directory, you can use the following configuration.</p>
</div>
<div class="paragraph">
<p>By convention, maven-confd-plugin templates and dictionaries are located in <code>src/main/confd/templates</code> and <code>src/main/confd/dictionaries</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;com.github.nodevops&lt;/groupId&gt;
            &lt;artifactId&gt;confd-maven-plugin&lt;/artifactId&gt;
            &lt;version&gt;0.1.0-SNAPSHOT&lt;/version&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;prepare&lt;/id&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;prepare&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                    &lt;templates&gt;
                        &lt;template&gt;
                            &lt;src&gt;src/main/confd/templates/template01.tmpl&lt;/src&gt;
                            &lt;dest&gt;target/generated-configuration/file01.properties&lt;/dest&gt;
                            &lt;keys&gt;
                                &lt;value&gt;/web&lt;/value&gt;
                            &lt;/keys&gt;
                        &lt;/template&gt;
                        &lt;template&gt;
                            &lt;src&gt;src/main/confd/templates/template02.tmpl&lt;/src&gt;
                            &lt;dest&gt;target/generated-configuration/datasource.xml.tmpl&lt;/dest&gt;
                            &lt;keys&gt;
                                &lt;value&gt;/web&lt;/value&gt;
                            &lt;/keys&gt;
                        &lt;/template&gt;
                    &lt;/templates&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
                &lt;execution&gt;
                    &lt;id&gt;generate&lt;/id&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;process&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;processor&gt;
                            &lt;name&gt;local-confd-processor&lt;/name&gt;
                            &lt;properties&gt;
                                &lt;property&gt;
                                    &lt;name&gt;binary.path&lt;/name&gt;
                                    &lt;value&gt;/usr/local/bin/confd&lt;/value&gt;
                                &lt;/property&gt;
                            &lt;/properties&gt;
                        &lt;/processor&gt;
                        &lt;dictionary&gt;src/main/confd/dictionaries/env01.dict&lt;/dictionary&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example does not really match a real case usage though, because you usally don&#8217;t deploy on your local dev environment, do you?</p>
</div>
</div>
<div class="sect2">
<h3 id="typical_use_case_local_development_delivery_package">Typical use case : local development + delivery package</h3>
<div class="paragraph">
<p>A full example of this setup can be found in the <a href="https://github.com/nodevops/confd-maven-plugin-sample-usages/tree/master/springboot-sample">spring-boot sample</a> in our <a href="https://github.com/nodevops/confd-maven-plugin-sample-usages">sample usages project</a>.</p>
</div>
<div class="sect3">
<h4 id="local_development">Local Development</h4>
<div class="paragraph">
<p>We want to be able to generate our config file for the local dev environment, and use it, so:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we rely on the common/shared configuration (i.e. not associated to a specific profile) that calls the <em>prepare</em> goal of the plugin. The <em>prepare</em> goal will generate a <strong>confd</strong> <em>toml</em> configuration file that would target a final generated file in the <code>target/generated-configuration</code> directory</p>
</li>
<li>
<p>we activate a <code>run-local</code> profile that triggers the <em>generate</em> goal that will process the template according to our local dictionary stored in <code>src/main/confd/dictionary/local.dict</code></p>
</li>
<li>
<p>because we want the build to be independent of the dev environment, we use the <em>java-processor</em> that doesn&#8217;t rely on the <em>confd</em> binary</p>
</li>
<li>
<p>the <code>run-local</code> profile also specifies to springboot where it can find its config file (through the springboot plugin)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="get_ready_for_the_delivery">Get ready for the delivery</h4>
<div class="paragraph">
<p>We want to generate a configuration artifact that will carry the templates and the ready to use confd toml files</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we rely on the common/shared configuration, that only calls the <em>prepare</em> goal</p>
</li>
<li>
<p>we use a dedicated <code>delivery</code> profile that overrides the final destination of the target file (that will be stored in the <em>toml</em> config file)</p>
</li>
<li>
<p>the same <code>delivery</code> profile uses the assembly plugin to generate a zip file that can be unzipped as-is in the <code>/etc/confd</code> directory on the destination server(s). This is the default directory structure expected by the confd binary</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="pom_xml_extract">pom.xml extract</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">...
&lt;build&gt;
    &lt;plugins&gt;
    ...
    &lt;plugin&gt;
        &lt;groupId&gt;com.github.nodevops&lt;/groupId&gt;
        &lt;artifactId&gt;confd-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
            &lt;execution&gt;
                &lt;!-- common step shared by all profiles that prepare the config file for further usage /--&gt;
                &lt;id&gt;prepare&lt;/id&gt;
                &lt;goals&gt;
                    &lt;goal&gt;prepare&lt;/goal&gt;
                &lt;/goals&gt;
                &lt;configuration&gt;
                    &lt;forceDestToLocalFileSystemType&gt;true&lt;/forceDestToLocalFileSystemType&gt;
                    &lt;templates&gt;
                        &lt;template&gt;
                            &lt;id&gt;application.yml&lt;/id&gt;
                            &lt;src&gt;src/main/confd/templates/application.yml.tmpl&lt;/src&gt;
                            &lt;dest&gt;${project.basedir}/target/generated-configuration/application.yml&lt;/dest&gt;
                            &lt;keys&gt;
                                &lt;value&gt;/your/namespace&lt;/value&gt;
                                &lt;value&gt;/runtime&lt;/value&gt;
                            &lt;/keys&gt;
                        &lt;/template&gt;
                    &lt;/templates&gt;
                &lt;/configuration&gt;
            &lt;/execution&gt;
        &lt;/executions&gt;
    &lt;/plugin&gt;
    ...
    &lt;/plugins&gt;
&lt;/build&gt;
...
&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;run-local&lt;/id&gt;
        &lt;activation&gt;
            &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
        &lt;/activation&gt;
        &lt;build&gt;
            &lt;plugins&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;com.github.nodevops&lt;/groupId&gt;
                    &lt;artifactId&gt;confd-maven-plugin&lt;/artifactId&gt;
                    &lt;executions&gt;
                        &lt;execution&gt;
                            &lt;!-- we want to generate the config files because we need it to run now /--&gt;
                            &lt;id&gt;generate&lt;/id&gt;
                            &lt;goals&gt;
                                &lt;goal&gt;process&lt;/goal&gt;
                            &lt;/goals&gt;
                            &lt;configuration&gt;
                                &lt;processor&gt;
                                    &lt;name&gt;java-processor&lt;/name&gt;
                                &lt;/processor&gt;
                                &lt;dictionary&gt;src/main/confd/dictionaries/local.dict&lt;/dictionary&gt;
                            &lt;/configuration&gt;
                        &lt;/execution&gt;
                    &lt;/executions&gt;
                &lt;/plugin&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                    &lt;configuration&gt;
                        &lt;arguments&gt;
                            &lt;argument&gt;--spring.config.location=file:target/generated-configuration/application.yml
                            &lt;/argument&gt;
                        &lt;/arguments&gt;
                    &lt;/configuration&gt;
                &lt;/plugin&gt;
            &lt;/plugins&gt;
        &lt;/build&gt;
    &lt;/profile&gt;
    &lt;profile&gt;
        &lt;id&gt;delivery&lt;/id&gt;
        &lt;build&gt;
            &lt;plugins&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;com.github.nodevops&lt;/groupId&gt;
                    &lt;artifactId&gt;confd-maven-plugin&lt;/artifactId&gt;
                    &lt;executions&gt;
                        &lt;execution&gt;
                            &lt;!-- mandatory: use the same id to get the benefit of the merge of the values with the global configuration --&gt;
                            &lt;id&gt;prepare&lt;/id&gt;
                            &lt;goals&gt;
                                &lt;goal&gt;prepare&lt;/goal&gt;
                            &lt;/goals&gt;
                            &lt;configuration&gt;
                                &lt;forceDestToLocalFileSystemType&gt;false&lt;/forceDestToLocalFileSystemType&gt;
                                &lt;templates&gt;
                                    &lt;template&gt;
                                        &lt;id&gt;application.yml&lt;/id&gt;
                                        &lt;!-- we only need to override the dest value, as long as we keep the templates in the same order as in the global config --&gt;
                                        &lt;dest&gt;/usr/local/appli/config/application.yml&lt;/dest&gt;
                                    &lt;/template&gt;
                                &lt;/templates&gt;
                            &lt;/configuration&gt;
                        &lt;/execution&gt;
                    &lt;/executions&gt;
                &lt;/plugin&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
                    &lt;executions&gt;
                        &lt;execution&gt;
                            &lt;id&gt;confd&lt;/id&gt;
                            &lt;goals&gt;
                                &lt;goal&gt;single&lt;/goal&gt;
                            &lt;/goals&gt;
                            &lt;phase&gt;package&lt;/phase&gt;
                            &lt;configuration&gt;
                                &lt;descriptors&gt;
                                    &lt;descriptor&gt;src/main/assembly/confd.xml&lt;/descriptor&gt;
                                &lt;/descriptors&gt;
                            &lt;/configuration&gt;
                        &lt;/execution&gt;
                    &lt;/executions&gt;
                &lt;/plugin&gt;
            &lt;/plugins&gt;
        &lt;/build&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2016.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
